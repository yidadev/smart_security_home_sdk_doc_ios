## 安防布撤防SDK-iOS
##### 接口说明
###### 初始化
```
/// 单例初始化
+ (instancetype)sharedInstance;

```

###### 注册代理
```
/// 添加代理协议
/// @param delegate 代理
- (void)addDelegate:(nonnull id<TYSecurityHomeProtocol>)delegate;

```
###### 获取网关列表

```
/// 获取家庭网关白名单设备
/// @param homeId 家庭id
/// @param successHandler 成功回调
/// @param failureHandler 失败回调
- (void)getLocationGateWayDeviceWithHomeId:(long long)homeId
                                   success:(void(^)(NSArray<NSString *> *dataArray))successHandler
                                   failure:(void(^)(NSError *error))failureHandler;

```
###### 参数说明

参数 | 说明
---|---
homeId | 家庭id
successHandler | 成功回调
failureHandler | 失败回调

###### 返回参数说明

参数 | 说明
---|---
dataArray | 网关id集合
error | 接口错误信息

###### 代码示例

```
[[TYSecurityModeBaseKit sharedInstance] getLocationGateWayDeviceWithHomeId:111
success:^(NSArray<NSString *> * _Nonnull dataArray) {
    //网关信息
} failure:^(NSError * _Nonnull error) {
    //错误
}];
```


###### 切换布撤防模式

```
- (void)switchSecurityArmModeWithHomeId:(long long)homeId
                                   mode:(ArmModeStatus)mode;

```
###### 参数说明

参数 | 说明
---|---
homeId | 家庭id
mode | 撤布防模式

###### 代码示例
```
[[TYSecurityModeBaseKit sharedInstance] switchSecurityArmModeWithHomeId:111
mode:ArmModeStatusDisarmed];
```
###### 响应代理(布撤防倒计时开始、过程中会响应securityModeDidSwitch:delayTime代理方法，倒计时结束统一走asynSecurityModeWillSwitchAfterDelay：代理方法)

```
- (void)securityModeDidSwitch:(ArmModeStatus)currentMode delayTime:(NSInteger)deleyTime {
   //倒计时过程中的查询回调
}
```

```
- (void)asynSecurityModeWillSwitchAfterDelay:(NSInteger)countDownTime {
    //倒计时结束时的查询回调，countDownTime为0
}
```


###### 查询当前布撤防状态

```
/// 查询当前布撤防状态
/// @param homeId 家庭id
- (void)querySecurityArmModeWithHomeId:(long long)homeId;

```
###### 代码示例

```
[[TYSecurityModeBaseKit sharedInstance] querySecurityArmModeWithHomeId:111];
```
###### 参数说明
参数 | 说明
---|---
homeId | 家庭id

###### 响应代理

```
- (void)securityModeDidSwitch:(ArmModeStatus)currentMode delayTime:(NSInteger)deleyTime {

}
```

###### 发起SOS报警

```
- (void)startSOSAlarmWithHomeId:(long long)homeId
                        sosType:(TYHSGatewaySOSType)type
                        success:(nullable void(^)(BOOL success))success
                        failure:(nullable void(^)(NSError *error))failure;

```
###### 参数说明
参数 | 说明
---|---
homeId | 家庭id
type | 报警类型
success | 成功回调
failure | 失败回调

###### 说明

```
发起SOS成功后，会接受到newAlarm类型的告警通知，业务方会收到名为"SecurityHomeZigbeeGateWayAlarmStateNotification"的通知，参数"@{@"alarm_state":@"alarm"}"
```

###### 查询bypass设备

```
- (void)queryLocationBypssDevicesWithHomeId:(long long)homeId;

```
###### 参数说明
参数 | 说明
---|---
homeId | 家庭id

###### 返回参数说明
参数 | 说明
---|---
deviceNodeIds | 设备NodeId集合

###### 响应代理

```
- (void)didReceiveBypassDevice:(NSArray<NSString *> *)deviceNodeIds {
}
```

###### 查询忽略设备(首页接口)

```
/// 布撤防时查询忽略设备
/// @param homeId 家庭id
- (void)queryLocationIgnoreDeviceWithHomeId:(long long)homeId;

```
###### 参数说明
参数 | 说明
---|---
homeId | 家庭id

###### 返回参数说明
参数 | 说明
---|---
deviceIds | 设备id集合


###### 响应代理

```
- (void)didReceiveUnusualDevice:(NSArray<NSString *> *)deviceIds {
}
```
###### 忽略设备列表页面实时监听忽略设备

```
/// bypass页面查询忽略设备(从网关查询)
/// @param mode 当前布撤防模式
/// @param handler 回调
- (void)queryIgnoreDeviceFromGateway:(ArmModeStatus)mode
                     completeHandler:(nullable TYSecurityGatewayIgnoreDevicesHandler)handler;

```
###### 参数说明
参数 | 说明
---|---
mode | 当前布撤防模式
handler | 回调

###### 返回参数说明
参数 | 说明
---|---
ignoreDevicesArray | 设备id集合

###### 代码示例

```
[[TYSecurityModeBaseKit sharedInstance] queryIgnoreDeviceFromGateway:ArmModeStatusDisarmed
completeHandler:^(NSArray<NSString *> * _Nullable ignoreDevicesArray) {
    //忽略设备信息
}];
```

###### 终止布撤防(忽略设备列表点击取消时调用)

```
/// 继续撤布防
/// @param homeId 家庭id
/// @param step 单次布撤防步骤
- (void)continueSwitchModeWithHomeId:(long long)homeId
                                step:(TYHSSwitchModeStep)step;

```
###### 参数说明
参数 | 说明
---|---
homeId | 家庭id
step | 是否继续(枚举)

###### 代码示例

```
[[TYSecurityModeBaseKit sharedInstance] continueSwitchModeWithHomeId:111
step:SwitchModeStep_Termination];
```
###### 获取家庭报警状态(启动时调用,包含报警倒计时信息)

```
/// 获取家庭报警状态(包含报警倒计时信息)
- (void)getHomeAlarmStateWithHomeId:(long long)homeId;
```
###### 参数说明
参数 | 说明
---|---
homeId | 家庭id


###### 返回参数说明
参数 | 说明
---|---
homeId | 家庭id
alarmState | 报警状态(枚举)
alarmVoice | 声音状态(枚举)
alarmCountdown | 报警倒计时

###### 代码示例

```
[[TYSecurityModeBaseKit sharedInstance] getHomeAlarmStateWithHomeId:1111];
```
###### 响应代理

```
- (void)didReceiveHomeAlarmInfo:(TYLocaitonStateModel *)model {
}
```
###### 说明
###### 当其他终端发起报警时，该代理方法也会同步调用

###### 错误回调

```
- (void)handlerError:(NSError *)error errorType:(TYSecurityModeErrorType)errorType {
    
}
```
###### 参数说明
参数 | 说明
---|---
error | 错误信息
errorType | 错误类型(标注是那一步发生错误)

###### 家庭布撤防最终结果回调(每一个网关的状态)
###### 返回参数说明

参数 | 说明
---|---
gwId | 网关id
state | 状态



```
- (void)shouldAlterGatewayStateView:(NSArray<TYSecurityGatewayStatuModel *> *)models {
    //网关最终信息
}
```


###### 查询abnormal设备

```
//接口
- (void)queryLocationAbnormalDevicesWithHomeId:(long long)homeId {
    
}
```
###### 参数说明
参数 | 说明
---|---
homeId | 家庭id

###### 返回参数说明

参数 | 说明
---|---
devId | 设备id
info | 设备状态文案



###### 代码示例

```
[[TYSecurityModeBaseKit sharedInstance] queryLocationAbnormalDevicesWithHomeId:111];
```
###### 回调
```
- (void)didReceiveAbnormalDevice:(NSArray<TYAbnormalDeviceModel *> *)deviceModel {
    //abnormal设备信息
}
```

###### 获取家庭网关语音密码是否设置过

```
- (void)getGatewayVoicePasswordStateWithHomeId:(long long)homeId
                                           type:(TYSecurityGatewayVoicePassCodeType)type
                                       success:(nullable void(^)(BOOL success))success
                                       failure:(nullable void(^)(NSError *error))failure;

```
###### 参数说明

参数 | 说明
---|---
homeId | 家庭id
type | 维度(1:家庭、2:个人)
success | 是否设置过
failure | 失败回调

###### 示例代码

```
[[TuyaSecuritySwitchModeManager sharedInstance] getGatewayVoicePasswordStateWithHomeId:123 type:TYSecurityGatewayVoicePassCodeType_Personal success:^(BOOL
success) {
    //是否设置过语音密码
} failure:^(NSError * _Nonnull error) {
    //错误信息
}];
```

###### 设置网关语音密码

```
- (void)setGatewayVoicePasswordWithHomeId:(long long)homeId
                                     type:(TYSecurityGatewayVoicePassCodeType)type
                       encryptionPassWord:(NSString *)encryptionPassWord
                                  success:(nullable void(^)(BOOL success))success
                                  failure:(nullable void(^)(NSError *error))failure;

```

###### 参数说明

参数 | 说明
---|---
homeId | 家庭id
type | 维度(1:家庭、2:个人)
encryptionPassWord | 密码信息(macMd5加密后的字符串)
success | 是否设置过
failure | 失败回调
###### 代码示例

```
[[TuyaSecuritySwitchModeManager sharedInstance] setGatewayVoicePasswordWithHomeId:123 type:TYSecurityGatewayVoicePassCodeType_Personal
encryptionPassWord:@"1111" success:^(BOOL success) {
    //设置成功
} failure:^(NSError * _Nonnull error) {
    //设置失败
}];
```











